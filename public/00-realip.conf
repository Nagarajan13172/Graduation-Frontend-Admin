# Make Nginx use the client IP forwarded by Traefik
real_ip_header X-Forwarded-For;
real_ip_recursive on;

# TRUST ONLY Traefik's network(s) â€” replace the CIDR with yours
# Find it with: docker network inspect <traefik_network> | grep Subnet
set_real_ip_from 10.0.0.0/8;
set_real_ip_from 172.16.0.0/12;   # covers all Docker bridge subnets
set_real_ip_from 192.168.0.0/16;

# (Optional) keep a log format that shows both the final client IP and the XFF chain
# If you keep your existing "main" format, $remote_addr will still be the real client IP after realip.
log_format realip '$remote_addr - $remote_user [$time_local] "$request" '
                  '$status $body_bytes_sent "$http_referer" "$http_user_agent" '
                  'xff="$http_x_forwarded_for"';
access_log /var/log/nginx/access.log realip;
 